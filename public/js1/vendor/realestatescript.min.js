jQuery(document).ready(function(){
  $.ajaxSetup({
    headers:{
      'X-CSRF-TOKEN':$('meta[name="csrf-token"]').attr('content')
    }
  });
//   alert(window.history.length);
jQuery("#gobackbtn").on('click',function(e){
     e.preventDefault();
    // alert("C");
     window.history.back();
     return false;
    // history.go(-1);
    // history.back();
  });
jQuery("#search").on('keyup',function(){
  var value=jQuery(this).val().toLowerCase();
  jQuery("#vacant tr").filter(function(){
    jQuery(this).toggle(jQuery(this).text().toLowerCase().indexOf(value) > -1);
  });
});
jQuery(document).on("keyup","#searchhh",function(){
    var value=jQuery(this).val().toLowerCase();
    var value=jQuery("#searchhh").val().toLowerCase();
    jQuery("#appendstatementhere tr").filter(function(){
    jQuery(this).toggle(jQuery(this).text().toLowerCase().indexOf(value) > -1);
  });
});

jQuery(document).on("keyup","#searchtenant",function(){

  var value=jQuery(this).val().toLowerCase();

  var value=jQuery("#searchtenant").val().toLowerCase();
 jQuery("#tenantttttt tr").filter(function(){
  jQuery(this).toggle(jQuery(this).text().toLowerCase().indexOf(value) > -1);
});
});
  //properties select
  jQuery("#propertyselect").on('change', function(){
   // alert("bitch");
   var status=jQuery("#selectstatus").val();
   var property_id=jQuery(this).val();
   var category=jQuery("#categoryselect").val();
   //alert(status);
   jQuery.ajax({
      type:'post',
      url:'/get/properties',
      data:{property_id:property_id,category:category,status:status},
      success:function(resp){
        //alert(resp);
        jQuery("#appendvacantunits").html(resp);
      // jQuery("#appendtenantbalances").html(resp);
      jQuery("#mydatatable").DataTable();

      },
      error:function(resp){
        // Swal.fire({
        //     title: 'Warning',
        //     text: resp,
        //     icon: 'warning',
        //   });
      }
  });
  });
    //search byvacantunitsbycategory
    jQuery("#categoryselect").on('change', function(){
      // alert("bitch");
     // var category=jQuery(this).val();
     var property_id=jQuery("#propertyselect").val();
     var status=jQuery("#selectstatus").val();

    var category=jQuery(this).val();
      //alert(property_id);
      jQuery.ajax({
         type:'post',
         url:'/get/categories',
         data:{category:category,property_id:property_id,status:status},
         success:function(resp){
        //alert(resp);
           jQuery("#appendvacantunits").html(resp);
         // jQuery("#appendtenantbalances").html(resp);
         jQuery("#mydatatable").DataTable();

         },
         error:function(resp){
            // Swal.fire({
            //     title: 'Warning',
            //     text: resp,
            //     icon: 'warning',
            //   });
         }
     });
     })
    //search byvacantunitsbycategory
    jQuery("#selectstatus").on('change', function(){
      // alert("bitch");
     var category=jQuery("#categoryselect").val();
     var property_id=jQuery("#propertyselect").val();
     var status=jQuery(this).val();

      jQuery.ajax({
         type:'post',
         url:'/get/statuss',
         data:{category:category,property_id:property_id,status:status},
         success:function(resp){
        //alert(resp);
           jQuery("#appendvacantunits").html(resp);
         // jQuery("#appendtenantbalances").html(resp);
         jQuery("#mydatatable").DataTable();

         },
         error:function(resp){
            // Swal.fire({
            //     title: 'Warning',
            //     text: resp,
            //     icon: 'warning',
            //   });
                 }
     });
     })
  //appendtenantbalances
  jQuery("#propertytenantbalance").on('change', function(){
    var month=jQuery("#monthselect").val();
  var year=jQuery("#yearselect").val();
    var property_id=jQuery(this).val();
    var fieldofficerselect=jQuery("#fieldofficerselect").val();
    var payableselect=jQuery("#payableselect").val();
  //  alert(property_id);
    jQuery.ajax({
       type:'post',
       url:'/get/tenantbalances',
       data:{property_id:property_id,fieldofficerselect:fieldofficerselect,payableselect:payableselect,month:month,year:year},
       success:function(resp){
        //alert(resp);
         jQuery("#appendtenantbalances").html(resp);
               //loading data table

          $("#tenantsdatatable").DataTable();
       },
       error:function(resp){
        // Swal.fire({
        //     title: 'Warning',
        //     text: resp,
        //     icon: 'warning',
        //   });
       }
   });
   });
 //selectbyfieldofficer
 jQuery("#fieldofficerselect").on('change', function(){
  var month=jQuery("#monthselect").val();
  var year=jQuery("#yearselect").val();
  var fieldofficer=jQuery(this).val();
  var property_id=jQuery("#propertytenantbalance").val();
  var payableselect=jQuery("#payableselect").val();

 //alert(payableselect);
 jQuery.ajax({
    type:'post',
    url:'/get/fieldofficer',
    data:{fieldofficer:fieldofficer,property_id:property_id,payableselect:payableselect,month:month,year:year},
    success:function(resp){
      //alert(resp);
      jQuery("#appendtenantbalances").html(resp);
            //loading data table

      $("#tenantsdatatable").DataTable();

    },
    error:function(resp){
        // Swal.fire({
        //     title: 'Warning',
        //     text: resp,
        //     icon: 'warning',
        //   });
    }
});
});
//selectbyfieldofficer
jQuery("#payableselect").on('change', function(){
  var month=jQuery("#monthselect").val();
  var year=jQuery("#yearselect").val();
  var payable=jQuery(this).val();
  var fieldofficer=jQuery("#fieldofficerselect").val();
  var property_id=jQuery("#propertytenantbalance").val();

 // alert(fieldofficer);
 jQuery.ajax({
    type:'post',
    url:'/get/payableselect',
    data:{payable:payable,property_id:property_id,fieldofficer:fieldofficer,month:month,year:year},
    success:function(resp){
    /*  if(resp==false){
        alert("Some select all fields");
      }else{*/
        jQuery("#appendtenantbalances").html(resp);
              //loading data table
        $("#tenantsdatatable").DataTable();

     // }
      //alert(resp);
    },
    error:function(resp){
        // Swal.fire({
        //     title: 'Warning',
        //     text: resp,
        //     icon: 'warning',
        //   });
    }
});
});

//selectbymonth
jQuery("#monthselect").on('change', function(){

  var month=jQuery(this).val();
  var year=jQuery("#yearselect").val();
  var payable=jQuery("#payableselect").val();
  var fieldofficer=jQuery("#fieldofficerselect").val();
  var property_id=jQuery("#propertytenantbalance").val();
 //alert(month);
 jQuery.ajax({
    type:'post',
    url:'/get/monthselect',
    data:{year:year,month:month,payable:payable,fieldofficer:fieldofficer,property_id:property_id},
    success:function(resp){
     //alert(resp);
      jQuery("#appendtenantbalances").html(resp);
      //loading data table
      $("#tenantsdatatable").DataTable();

    },
    error:function(resp){
        // Swal.fire({
        //     title: 'Warning',
        //     text: resp,
        //     icon: 'warning',
        //   });
    }
});
});
//selectbyyear
jQuery("#yearselect").on('change', function(){
  var month=jQuery("#monthselect").val();
  var year=jQuery(this).val();
  var payable=jQuery("#payableselect").val();
  var fieldofficer=jQuery("#fieldofficerselect").val();
  var property_id=jQuery("#propertytenantbalance").val();
 jQuery.ajax({
    type:'post',
    url:'/get/yearselect',
    data:{year:year,month:month,payable:payable,fieldofficer:fieldofficer,property_id:property_id},
    success:function(resp){
    //alert(resp);
      jQuery("#appendtenantbalances").html(resp);
            //loading data table
        $("#tenantsdatatable").DataTable();

    },
    error:function(resp){
        // Swal.fire({
        //     title: 'Warning',
        //     text: resp,
        //     icon: 'warning',
        //   });
    }
});
});
/**choosen */
jQuery(".choosen").chosen();
// jQuery('.choosen').chosen({ height: "40px"});

//tenantstatement
jQuery("#propertyfill").on('change',function(){
    //alert(jQuery(this).val());
    var property_id=jQuery(this).val();
    jQuery.ajax({
        type:'post',
        url:'/get/tenantstatement',
        data:{property_id:property_id},
        success:function(data){
          //  alert(data);
          //  console.log(data);
          jQuery("#appendtenatshere").html(data);
         jQuery(".choosen").chosen();


        },
        error:function(data){
            // Swal.fire({
            //     title: 'Warning',
            //     text: data,
            //     icon: 'warning',
            //   });
        }
    });
});
//generatetenantstatement
jQuery("#generatetenantstatement").on('click',function(e){
  e.preventDefault();
  //  alert("generate tenant statement button  clicked");
  var t_code=jQuery("#tenantfill").val();
  var datefrom=jQuery("#datefrom").val();
  var dateto=jQuery("#dateto").val();
  var property_id=jQuery("#propertyfill").val();
 // alert(datefrom);
  if(property_id=='' || property_id=='All;All'){
    Swal.fire({
        title: 'Warning',
        text: "property is required",
        icon: 'warning',
        // showCancelButton: true,
        // confirmButtonColor: '#3085d6',
        // cancelButtonColor: '#d33',
        // confirmButtonText: 'Yes, delete it!'
      });
  }else{
 if(t_code==''|| t_code=='All;All'){
     //alert("select  a tenant");
     Swal.fire({
        title: 'Warning',
        text: "you must Select a tenant",
        icon: 'warning',
        // showCancelButton: true,
        // confirmButtonColor: '#3085d6',
        // cancelButtonColor: '#d33',
        // confirmButtonText: 'Yes, delete it!'
      });
  }

//   else {
//       if(datefrom==''|| dateto=="dd/mm/yyyy"){
//       alert("you must select the start date");
//       }else{
//           if(dateto==''|| dateto=="dd/mm/yyyy"){
//               alert("You must select the end date");
//           }
else{
      jQuery.ajax({
          type:'post',
          url:'/tenant/generatestatement',
          data:{property_id:property_id,t_code:t_code,datefrom:datefrom,dateto:dateto},

          success:function(resp){
              // alert(resp);
               console.log(resp);
             jQuery("#singletenantstatement").html(resp);

             var di=document.getElementById("displayblock");
            //alert("mnb");
            di.style.display="block";
            },
          error:function(resp){
              //alert("error");
              Swal.fire({
                title: 'Warning',
                text: resp,
                icon: 'warning',
              });
            }
      });
    }
// }//
//   }//
  }
});

/**Changes in login */
jQuery(Document).on('change',"#selecttype",function(){
    var typeselected=jQuery("#selecttype").val();
    if(typeselected==''){
        Swal.fire({
            title: 'Warning',
            text: "Select who to login as",
            icon: 'warning',
          });
    }else if(typeselected=="staff"){
        var defaultpage=document.getElementById("defaultpage");
        defaultpage.style.display="none";
        var stafflogin=document.getElementById("staffloginblock");
         stafflogin.style.display="block";
    }else if(typeselected=="salesagent"){
        var defaultpage=document.getElementById("defaultpage");
        defaultpage.style.display="none";
        var stafflogin=document.getElementById("staffloginblock");
         stafflogin.style.display="none";
         var landlordlogin=document.getElementById("salesagentoginblock");
         landlordlogin.style.display="block";

    }else if(typeselected=="landlord"){
        var defaultpage=document.getElementById("defaultpage");
        defaultpage.style.display="none";
        var stafflogin=document.getElementById("staffloginblock");
         stafflogin.style.display="none";
         var landlordlogin=document.getElementById("landlordloginblock");
         landlordlogin.style.display="block";

    }else if(typeselected=="tenant"){
        var defaultpage=document.getElementById("defaultpage");
        defaultpage.style.display="none";
        var stafflogin=document.getElementById("staffloginblock");
         stafflogin.style.display="none";
         var landlordlogin=document.getElementById("landlordloginblock");
         landlordlogin.style.display="none";
       var tenantlogin=document.getElementById("tenantloginblock");
         tenantlogin.style.display="block";
    }else if(typeselected=="salesclient"){
        var defaultpage=document.getElementById("defaultpage");
        defaultpage.style.display="none";
        var stafflogin=document.getElementById("staffloginblock");
         stafflogin.style.display="none";
         var landlordlogin=document.getElementById("landlordloginblock");
         landlordlogin.style.display="none";
       var tenantlogin=document.getElementById("tenantloginblock");
         tenantlogin.style.display="none";
         var salesclient=document.getElementById("salesclientloginblock");
         salesclient.style.display="block";
         var salesagent=document.getElementById("salesagentoginblock");
         salesagent.style.display="none";

    }else{
        // alert("who to login");
    }
});
/**End Changes in login */


// /** start of staff login  block */
//   jQuery("#staffradio").on('click',function(){
//     //alert("staff login selected");
//      jQuery("#staffloginblock").show();
//      jQuery("#landlordloginblock").hide();
//      jQuery("#tenantloginblock").hide();
//   });
// /** end of staff login block */
// /** start of landlord login  block */
//   jQuery("#landlordradio").on('click',function(){
//     //alert("landlord login selected");
//      jQuery("#staffloginblock").hide();
//      jQuery("#landlordloginblock").show();
//      jQuery("#tenantloginblock").hide();
//       });
// /** end of landlord login block */

// /** start of landlord login  block */
//   jQuery("#tenantradio").on('click',function(){
//     //alert("tenant login selected");
//     jQuery("#staffloginblock").hide();
//     jQuery("#landlordloginblock").hide();
//     jQuery("#tenantloginblock").show();
//   });
// /** end of landlord login block */
// /** start of landlord login  block */
//  jQuery("#staffradioinlandlord").on('click',function(){
//     //alert("staff login selected");
//      jQuery("#staffloginblock").show();
//      jQuery("#landlordloginblock").hide();
//      jQuery("#tenantloginblock").hide();
//   });
//   jQuery("#tenantradioinlandlord").on('click',function(){
//     //alert("tenant login selected in landlord");
//      jQuery("#staffloginblock").hide();
//      jQuery("#landlordloginblock").hide();
//      jQuery("#tenantloginblock").show();
//   });
//    jQuery("#staffradiointenant").on('click',function(){
//     //alert("staff login selected");
//      jQuery("#staffloginblock").show();
//      jQuery("#landlordloginblock").hide();
//      jQuery("#tenantloginblock").hide();
//   });
//    jQuery("#landlordradiointenant").on('click',function(){
//     //alert("landlord login selected");
//      jQuery("#staffloginblock").hide();
//      jQuery("#landlordloginblock").show();
//      jQuery("#tenantloginblock").hide();
//       });
/** end of landlord login block */
/**loggedtenantstatement */
jQuery("#loggedtenantstatementbtn").on('click',function(e){
    e.preventDefault();
    var t_code=jQuery("#loggedtenantcode").val();
    var datefrom=jQuery("#datefrom").val();
    var dateto=jQuery("#dateto").val();
    if(t_code==''){
        Swal.fire({
            title: 'Warning',
            text: "Account is required",
            icon: 'warning',
          });
      }else{
     if(datefrom==''){
         //alert("select  a tenant");
         Swal.fire({
            title: 'Warning',
            text: "you must Select a start date",
            icon: 'warning',

          });
      }


    else{
          jQuery.ajax({
              type:'post',
              url:'/loggedtenant/previewstatement',
              data:{t_code:t_code,datefrom:datefrom,dateto:dateto},
              success:function(resp){
                   //alert(resp);
                   console.log(resp);
                jQuery("#loggedtenantstatement").html(resp);
                 jQuery("#generate_pddf").show();
                //  var di=document.getElementById("displayblock");
                //alert("mnb");
                // di.style.display="block";
                },
              error:function(resp){
                  //alert("error");
                  Swal.fire({
                    title: 'Warning',
                    text: resp,
                    icon: 'warning',
                  });
                }
          });
        }

      }

});
// jQuery(document).on("change","#landlordpropertyselect",function(){
    jQuery("#landlordpropertyselect").on('change',function(){
   var landlordpropertyid=jQuery("#landlordpropertyselect").val();
  // alert(landlordpropertyid);
  if(landlordpropertyid==''){
    // Swal.fire({
    //     title: 'Warning',
    //     text: "you must Select a property",
    //     icon: 'warning',

    //   });
  }else{
      jQuery.ajax({
          type:'post',
          url:'/loggedlandlord/fetchpayablesonpropertychange',
          data:{landlordpropertyid:landlordpropertyid},
          success:function(resp){
            // alert(resp);
              console.log(resp);
             jQuery("#appendlanadlordpayablesonpropertychanged").html(resp);
                        jQuery("#landlordpropertystat").DataTable();

          },
          error:function(resp){
            Swal.fire({
                title: 'Warning',
                text: resp,
                icon: 'warning',

              });
          }
      });
  }
});
 jQuery("#landlordpropertyselect").on('change',function(){

    var landlordpropertyid=jQuery("#landlordpropertyselect").val();
    var landlordpayable=jQuery("#landlordonpropayableselect").val();
    var landlordmonth=jQuery("#landlordmonthselect").val();
    var landlordyear=jQuery("#landlordyearselect").val();
    // alert(landlordpayable);
    if(landlordpropertyid ==null || landlordpayable ==null || landlordmonth==null || landlordyear==null){
        alert("one of them is empty");
    }else if(landlordpropertyid =='' && landlordpayable !==null){
         alert("Property is null");

    }else{
        jQuery.ajax({
            type:'post',
            url:'/loggedlandlord/fetchrecordsonpropertyselect',
            data:{landlordpropertyid:landlordpropertyid,landlordpayable:landlordpayable,landlordmonth:landlordmonth,landlordyear:landlordyear},
         success:function(resp){
             // alert(resp);
              // console.log(resp);
               //jQuery("#landlordrecordss").html(resp);
               jQuery("#appendlandlordstatements").html(resp);
               jQuery("#landlordpropertystat").DataTable();

            },
            error:function(resp){
              Swal.fire({
                  title: 'Warning',
                  text: resp,
                  icon: 'warning',

                });
            }
        });
    }

 });
 jQuery("#landlordmonthselect").on('change',function(){
          var month=jQuery("#landlordmonthselect").val();
          var year=jQuery("#landlordyearselect").val();
          var property=jQuery("#landlordpropertyselect").val();
          var payable=jQuery("#landlordonpropayableselect").val();
          if(property !==''){
              jQuery.ajax({
                  type:'post',
                  url:'/fetch/statement/onmonthselect',
                  data:{month:month,year:year,property:property,payable:payable},
                  success:function(resp){
                    //  alert(resp);
                     jQuery("#appendlandlordstatements").html(resp);
                     $("#landlordpropertystat").DataTable();
                     jQuery("#landlordpropertystat").DataTable();

                    },
                  error:function(resp){
                    Swal.fire({
                        title: 'Warning',
                        text: resp,
                        icon: 'warning',
                      });
                  }
              });
          }else{
            //   alert("select a property first");

          }

 });

 jQuery("#landlordmonthselect").on('change',function(){
          var month=jQuery("#landlordmonthselect").val();
          var year=jQuery("#landlordyearselect").val();
          var property=jQuery("#landlordpropertyselect").val();
          var payable=jQuery("#landlordonpropayableselect").val();
          if(property !==''){
              jQuery.ajax({
                  type:'post',
                  url:'/fetch/statement/onmonthselect',
                  data:{month:month,year:year,property:property,payable:payable},
                  success:function(resp){
                    //  alert(resp);
                     jQuery("#appendlandlordstatements").html(resp);
                     jQuery("#landlordpropertystat").DataTable();

                  },
                  error:function(resp){
                    Swal.fire({
                        title: 'Warning',
                        text: resp,
                        icon: 'warning',
                      });
                  }
              });
          }else{
            //   alert("select a property first");

          }

 });

 jQuery("#landlordyearselect").on('change',function(){
    var month=jQuery("#landlordmonthselect").val();
    var year=jQuery("#landlordyearselect").val();
    var property=jQuery("#landlordpropertyselect").val();
    var payable=jQuery("#landlordonpropayableselect").val();
    if(property !==''){
        jQuery.ajax({
            type:'post',
            url:'/fetch/statement/onyearselect',
            data:{month:month,year:year,property:property,payable:payable},
            success:function(resp){
              //  alert(resp);
               jQuery("#appendlandlordstatements").html(resp);
               jQuery("#landlordpropertystat").DataTable();

            },
            error:function(resp){
                Swal.fire({
                    title: 'Warning',
                    text: resp,
                    icon: 'warning',
                  });
            }
        });
    }else{
        // alert("select a property first");

    }

});
// jQuery(document).on("change","#landlordpropertyselect",function(){

jQuery("#appendlanadlordpayablesonpropertychanged").on('change',function(){
    var month=jQuery("#landlordmonthselect").val();
    var year=jQuery("#landlordyearselect").val();
    var property=jQuery("#landlordpropertyselect").val();
    var payable=jQuery("#landlordonpropayableselect").val();
    if(property !==''){
        jQuery.ajax({
            type:'post',
            url:'/fetch/statement/onpayableselect',
            data:{month:month,year:year,property:property,payable:payable},
            success:function(resp){
             //  alert(resp);
              console.log(resp);
               jQuery("#appendlandlordstatements").html(resp);
               jQuery("#landlordpropertystat").DataTable();

            },
            error:function(resp){
                Swal.fire({
                    title: 'Warning',
                    text: resp,
                    icon: 'warning',
                  });
            }
        });
    }else{
        Swal.fire({
            title: 'Warning',
            text: "select a property first",
            icon: 'warning',
          });

    }

});
//landlord stmt and transactions

jQuery("#pre_view_stmt_ll").on("click",function(e){
    e.preventDefault();
    var property=jQuery("#ladlorstmtselect").val();
    var month=jQuery("#landlordstmtmonthselect").val();
    var year=jQuery("#landlordstmtyearselect").val();
    if(property=='' || month=='' || year==''){
        Swal.fire({
            title: 'Warning',
            text: "One or more empty fields",
            icon: 'warning',
          });
    }else{
        jQuery.ajax({
            type:'post',
            url:'/landlord_stmt_preview/get',
            data:{property:property,month:month,year:year},
            success:function(resp){
            // alert(resp);
            //    console.log(resp);
                 jQuery("#appentstmtllhere").html(resp);
                 var generatepdfforlltransactions=document.getElementById("generatepdfforlltransactions");
                 generatepdfforlltransactions.style.display="block";
            },
            error:function(resp){
              //  alert(resp);
              Swal.fire({
                title: 'Warning',
                text: resp,
                icon: 'warning',
              });

            }
        });
    }
});
/**sales agent */
jQuery(Document).on('change','#projectstatuselect',function(){
    var projectstatuselect=jQuery(this).val();
    var projectselect=jQuery("#projectselect").val();
    if(projectselect=="" || projectselect==null){
        Swal.fire({
            title: 'Warning',
            text: "select a project",
            icon: 'warning',
          });
    }else{
     jQuery.ajax({
        type:'post',
        url:'/sales_agent/preview_project_status',
        data:{projectselect:projectselect,projectstatuselect:projectstatuselect},
        success:function(resp){
            //   alert(resp);
              jQuery("#appendprojectstatuseshere").html(resp);
              jQuery("#myprojectstatuses").DataTable();


        },error:function(resp){
            alert(resp.message);
        }
     });
    }
});
/**end */

jQuery(Document).on('change','#clientdropdown',function(){
         var ClientNo=jQuery("#clientdropdown").val();

        if(ClientNo !==null && ClientNo !==""){
                $.ajax({
                    type:'post',
                    url:'/sales_agent/view_client_statements',
                    data:{ClientNo:ClientNo},
                    success:function(resp){
                        // alert(resp);
                        jQuery("#appendclientstatementshere").html(resp);
                          var di=document.getElementById("salesclientgpdfbtn");
                         di.style.display="block";
                        jQuery("#myclientstatements").DataTable();
                    },error:function(resp){
                        alert(resp.message);
                    }
                   });

        }else{
            Swal.fire({
                title: 'Warning',
                text: "select a client",
                icon: 'warning',
              });
        }

});
});
